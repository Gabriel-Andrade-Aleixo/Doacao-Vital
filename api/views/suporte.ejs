<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Suporte - Hemocentro</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="/estilos/login.css" />
</head>

<style>
    body {
        background-color: rgb(255, 255, 234);
    }
    header {
        border: solid 1px black;
        height: 15vh;
        background-color: rgb(189, 90, 57);
    }
   
</style>

<body>
    <header>
        <div class="row">
            <div id="setecols" class="form-group col-md-7">
                <figure>
                    <img id="logo" src="./imagens/Gota.png" alt="Logo Projeto do Hemocentro">
                </figure>
            </div>
            <h1>Titulo Legal</h1>
            <div class="col-md-3">
                <nav class="linkAlunos">
                    <ul>
                        <li><a href="/solicitacao">Solicitações</a></li>
                        <li><a href="/emoProx">Hemocentros</a></li>
                        <li><a href="/suporte">Suporte</a></li>
                        <li><a href="/contaUsuario">Conta</a></li>
                    </ul>
                </nav>
            </div>
        </div>
    </header>
    <h1>Suporte</h1>
    <hr>
    <main class="chat-container">
        <div class="chat-box" id="chatBox">
            <div class="bot-message">Olá! Em que posso ajudar?</div>
        </div>
        <div class="chat-input-container" id="optionsContainer">
            <script>
                let currentOptions = []; 
                let thankedOnce = false; 
                
                function sendChoice(choice) {
                    const chatBox = document.getElementById('chatBox');
                    const optionsContainer = document.getElementById('optionsContainer');
            
                
                    const userMessage = document.createElement('div');
                    userMessage.classList.add('user-message');
                    userMessage.textContent = choice; 
                    chatBox.appendChild(userMessage);
            
                   
                    fetch('/suporte/mensagem', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ choice })
                    })
                    .then(response => response.json())
                    .then(data => {
                        const botResponse = document.createElement('div');
                        botResponse.classList.add('bot-message');
            
                        if (choice === "obrigado" && !thankedOnce) {
                            botResponse.textContent = 'De nada! Fico feliz em poder ajudar!';
                            thankedOnce = true;
                            displayOptions(['Voltar']); // Exibe somente a opção "Voltar" ao final da conversa
                        } else if (choice === "ajuda") {
                            botResponse.textContent = data.botResponse;
                            currentOptions = ['Documentação', 'Tutoriais', 'Suporte Técnico', 'Voltar'];
                            displayOptions(currentOptions);
                        } else if (choice === "problema") {
                            botResponse.textContent = data.botResponse;
                            currentOptions = ['Onde doar?', 'Erro de login', 'Outro', 'Voltar'];
                            displayOptions(currentOptions);
                        } else if (choice === "contato") {
                            botResponse.textContent = data.botResponse;
                            currentOptions = ['Telefone', 'Email', 'Voltar'];
                            displayOptions(currentOptions);
                        } else if (choice === "voltar") {
                            botResponse.textContent = 'Claro, vamos recomeçar nossa conversa.';
                            thankedOnce = false; 
                            displayOptions(['Ajuda', 'Problema', 'Contato']);
                        } else if (choice === "onde doar?") {
                            botResponse.textContent = 'Vá para a página de Solicitação para mais informações :)';
                            displayOptions(['Obrigado', 'Voltar']); 
                        } else if (["documentação", "tutoriais", "suporte técnico", "erro de login", "outro", "telefone", "email"].includes(choice)) {
                            botResponse.textContent = data.botResponse;
                            displayOptions(['Obrigado', 'Voltar']);
                        }
            
                        chatBox.appendChild(botResponse);
                        chatBox.scrollTop = chatBox.scrollHeight;
                    })
                    .catch(error => {
                        console.error('Erro ao enviar a mensagem:', error);
                    });
                }
            
              
                function displayOptions(options) {
                    const optionsContainer = document.getElementById('optionsContainer');
                    optionsContainer.innerHTML = ''; // Limpa as opções anteriores
            
                    options.forEach(option => {
                        const optionButton = document.createElement('button');
                        optionButton.classList.add('option-button');
                        optionButton.textContent = option;
                        optionButton.onclick = function() {
                            sendChoice(option.toLowerCase());
                        };
                        optionsContainer.appendChild(optionButton);
                    });
                }
            
                // Exibe as opções iniciais ao carregar a página
                window.onload = function() {
                    displayOptions(['Ajuda', 'Problema', 'Contato']);
                };
            </script>
            
            
        
        </div>
    </main>



    
</body>

</html>
